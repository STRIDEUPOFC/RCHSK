<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCHSK | Portfolio Management</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Montserrat:wght@200;400;700&family=JetBrains+Mono:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg-dark: #0f0f0f;
            --bg-card: #1a1a1a;
            --bg-panel: #141414;
            --bg-detail: #111111; /* Fundo da expansão */
            --text-primary: #f0f0f0;
            --text-secondary: #888888;
            --accent: #ffffff;
            --gold: #c5a059;
            --gold-dim: rgba(197, 160, 89, 0.2);
            --success: #2ecc71;
            --danger: #e74c3c;
            --border: rgba(255,255,255,0.08);
            --border-active: rgba(255,255,255,0.15);
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            
            --font-main: 'Inter', sans-serif;
            --font-display: 'Montserrat', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: var(--font-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* --- LAYOUT UTILS --- */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.8s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- DASHBOARD CONTAINER --- */
        #private-dashboard {
            padding: 4rem 5%;
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
        }

        .dash-header {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin-bottom: 3rem; padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }
        .dash-header h1 { font-family: var(--font-display); font-weight: 700; font-size: 2rem; }
        .subtitle { color: var(--gold); font-size: 0.75rem; letter-spacing: 0.15em; text-transform: uppercase; margin-bottom: 0.5rem; display: block; }

        /* --- TABLE STYLES --- */
        .table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            overflow: hidden; /* Importante para bordas */
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        
        th {
            text-align: left; padding: 1.5rem; color: var(--text-secondary);
            text-transform: uppercase; letter-spacing: 0.1rem; font-weight: 500; font-size: 0.7rem;
            border-bottom: 1px solid var(--border); font-family: var(--font-display);
            background: rgba(255,255,255,0.02);
        }

        td {
            padding: 1.5rem; border-bottom: 1px solid var(--border);
            font-family: var(--font-code); color: var(--text-primary);
            transition: background 0.2s;
        }

        /* Linhas clicáveis (Master Rows) */
        tr.master-row { cursor: pointer; position: relative; }
        tr.master-row:hover { background: rgba(255,255,255,0.03); }
        
        /* Indicador de expansão (setinha ou linha lateral) */
        tr.master-row::after {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
            background: var(--gold); transform: scaleY(0); transition: transform 0.3s ease;
        }
        tr.master-row.expanded::after { transform: scaleY(1); }
        tr.master-row.expanded { background: rgba(255,255,255,0.04); }

        /* --- EXPANSION SYSTEM (DETAIL ROW) --- */
        tr.detail-row {
            background-color: var(--bg-detail);
            display: none; /* Controlado via JS */
        }
        
        tr.detail-row.visible {
            display: table-row;
        }

        .detail-wrapper {
            padding: 0;
            overflow: hidden;
            border-bottom: 1px solid var(--border-active);
            animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* GRID INTERNO DO STRIDEUP */
        .system-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            padding: 2.5rem;
        }

        /* Cards de Métricas Internas */
        .stat-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            padding: 1.25rem;
            border-radius: 4px;
            position: relative;
            transition: var(--transition);
        }
        .stat-card:hover {
            border-color: var(--gold-dim);
            background: rgba(255,255,255,0.05);
        }

        .stat-label {
            font-family: var(--font-display);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            display: block;
        }

        .stat-value {
            font-family: var(--font-code);
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .stat-unit { font-size: 0.8rem; color: var(--text-secondary); margin-left: 4px; }
        
        /* Cores de Status Específicas */
        .color-gold { color: var(--gold) !important; }
        .color-green { color: var(--success) !important; }
        .color-red { color: var(--danger) !important; }

        /* Pills & Tags */
        .status-pill {
            padding: 4px 12px; border-radius: 20px; font-size: 0.7rem;
            background: rgba(255,255,255,0.1); font-family: var(--font-main);
            display: inline-block;
        }
        .status-pill.active { background: rgba(46, 204, 113, 0.15); color: #2ecc71; border: 1px solid rgba(46, 204, 113, 0.2); }
        .status-pill.warning { background: rgba(197, 160, 89, 0.15); color: var(--gold); border: 1px solid rgba(197, 160, 89, 0.2); }

        /* Variações na tabela principal */
        .value-up { color: var(--success); }
        .value-down { color: var(--danger); }

        /* Observação Larga */
        .full-width-card {
            grid-column: 1 / -1;
            border-left: 2px solid var(--gold);
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .table-container { overflow-x: auto; }
            table { min-width: 600px; }
            .system-grid { grid-template-columns: 1fr; padding: 1.5rem; }
            .dash-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
        }
    </style>
</head>
<body>

    <div id="private-dashboard" class="fade-in">
        <div class="dash-header">
            <div>
                <span class="subtitle">Holding / Active Systems</span>
                <h1>Portfolio Intelligence</h1>
            </div>
            <div style="text-align: right;">
                <p style="font-size: 0.8rem; font-family: var(--font-code); color: var(--success);">● SYSTEM ONLINE</p>
                <p id="currentDate" style="color: var(--text-secondary); font-size: 0.7rem; font-family: var(--font-code); margin-top:5px;"></p>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Ativo Patrimonial</th>
                        <th>Categoria</th>
                        <th>Status</th>
                        <th>Variação (1m)</th>
                        <th>Valor de Mercado</th>
                    </tr>
                </thead>
                <tbody id="asset-table-body">
                    </tbody>
            </table>
        </div>

        <div style="margin-top: 2rem; text-align: right; opacity: 0.5; font-size: 0.7rem; font-family: var(--font-code);">
            RCHSK SECURE SERVER // ENCRYPTED
        </div>
    </div>

<script>
    // --- CONFIGURAÇÃO ---
    // URL do seu Web App do Google Apps Script
    // Para teste, deixe vazio e o sistema usará MOCK_DATA
    const API_URL = "URL_DO_SEU_APPS_SCRIPT_AQUI"; 

    // --- DADOS SIMULADOS (MOCK) ---
    // Usado se a API falhar ou não estiver configurada
    const MOCK_DATA = {
        macro: [
            {
                "ATIVO_ID": "STRIDEUP",
                "ATIVO PATRIMONIAL": "STRIDEUP System (Neural)",
                "CATEGORIA": "Algorithmic Trading",
                "STATUS": "Operacional",
                "EXPECTED(MONTH)": 45320,
                "VALOR EM MERCADO": 12500000
            },
            {
                "ATIVO_ID": "REAL_ESTATE_01",
                "ATIVO PATRIMONIAL": "Zurich Office Complex",
                "CATEGORIA": "Imobiliário",
                "STATUS": "Alugado",
                "EXPECTED(MONTH)": 12800,
                "VALOR EM MERCADO": 4200000
            },
            {
                "ATIVO_ID": "M3_COMP",
                "ATIVO PATRIMONIAL": "BMW M3 Competition",
                "CATEGORIA": "Automotivo",
                "STATUS": "Hangar",
                "EXPECTED(MONTH)": 1240,
                "VALOR EM MERCADO": 645000
            }
        ],
        details: [
            // Dados específicos do STRIDEUP
            { "ATIVO_ID": "STRIDEUP", "METRICA": "ROI (7 Dias)", "VALOR": "3.4", "UNIDADE": "%", "STATUS": "positive", "OBS": "" },
            { "ATIVO_ID": "STRIDEUP", "METRICA": "ROI (Acumulado)", "VALOR": "142.8", "UNIDADE": "%", "STATUS": "positive", "OBS": "" },
            { "ATIVO_ID": "STRIDEUP", "METRICA": "Capital Líquido", "VALOR": "12.500", "UNIDADE": "MM", "STATUS": "neutral", "OBS": "Alocação dinâmica" },
            { "ATIVO_ID": "STRIDEUP", "METRICA": "Drawdown Max", "VALOR": "-2.1", "UNIDADE": "%", "STATUS": "warning", "OBS": "" },
            { "ATIVO_ID": "STRIDEUP", "METRICA": "Trades Ativos", "VALOR": "8", "UNIDADE": "", "STATUS": "neutral", "OBS": "" },
            { "ATIVO_ID": "STRIDEUP", "METRICA": "Health Check", "VALOR": "100", "UNIDADE": "%", "STATUS": "positive", "OBS": "Latência < 20ms" },
            { "ATIVO_ID": "STRIDEUP", "METRICA": "Next Rebalance", "VALOR": "04h 12m", "UNIDADE": "", "STATUS": "neutral", "OBS": "" },
            { "ATIVO_ID": "STRIDEUP", "METRICA": "Insight Estratégico", "VALOR": "Alta Volatilidade", "UNIDADE": "", "STATUS": "gold", "OBS": "O modelo identificou oportunidade de arbitragem em pares EUR/USD devido a notícias macroeconômicas. Exposição aumentada em 15%." }
        ]
    };

    // --- VARIÁVEIS GLOBAIS ---
    let globalData = { macro: [], details: [] };
    let expandedRowId = null;

    // --- FUNÇÕES CORE ---

    async function initDashboard() {
        // Data atual
        document.getElementById('currentDate').innerText = new Date().toLocaleString('pt-BR');
        
        try {
            // Tenta fetch na API real
            if(API_URL && API_URL !== "URL_DO_SEU_APPS_SCRIPT_AQUI") {
                const res = await fetch(API_URL);
                const data = await res.json();
                globalData = data;
            } else {
                // Fallback para Mock
                console.log("Usando dados simulados (Mock)");
                globalData = MOCK_DATA;
                // Simula delay de rede
                await new Promise(r => setTimeout(r, 600)); 
            }
            renderTable();
        } catch (e) {
            console.error("Erro ao carregar:", e);
            // Fallback em caso de erro
            globalData = MOCK_DATA;
            renderTable();
        }
    }

    function renderTable() {
        const tbody = document.getElementById("asset-table-body");
        tbody.innerHTML = "";

        globalData.macro.forEach((asset, index) => {
            const assetId = asset.ATIVO_ID || `row-${index}`;
            const hasDetails = globalData.details.some(d => d.ATIVO_ID === assetId);
            
            // Formatando valores
            const variacao = Number(asset["EXPECTED(MONTH)"]) || 0;
            const valor = Number(asset["VALOR EM MERCADO"]) || 0;
            const variacaoClass = variacao >= 0 ? "value-up" : "value-down";
            const variacaoSymbol = variacao >= 0 ? "+" : "";

            // 1. Criar a LINHA MASTER
            const tr = document.createElement("tr");
            tr.className = "master-row";
            tr.dataset.id = assetId;
            tr.onclick = () => toggleDetails(assetId, hasDetails);

            tr.innerHTML = `
                <td>
                    ${asset["ATIVO PATRIMONIAL"]} 
                    ${hasDetails ? '<span style="font-size:0.6rem; color:var(--gold); margin-left:8px;">[+]</span>' : ''}
                </td>
                <td>${asset["CATEGORIA"] || asset["CATEGORIA "]}</td>
                <td><span class="status-pill ${asset.STATUS === 'Operacional' ? 'active' : ''}">${asset.STATUS}</span></td>
                <td class="${variacaoClass}">${variacaoSymbol} R$ ${variacao.toLocaleString("pt-BR")}</td>
                <td style="font-weight:700">R$ ${valor.toLocaleString("pt-BR")}</td>
            `;
            tbody.appendChild(tr);

            // 2. Criar a LINHA DE DETALHES (Oculta por padrão)
            if (hasDetails) {
                const detailTr = document.createElement("tr");
                detailTr.className = "detail-row";
                detailTr.id = `detail-${assetId}`;
                
                // Célula única ocupando todas as colunas
                const detailTd = document.createElement("td");
                detailTd.colSpan = 5; 
                detailTd.className = "detail-wrapper";
                
                // Conteúdo interno (Grid)
                detailTd.innerHTML = buildDetailsHTML(assetId);
                
                detailTr.appendChild(detailTd);
                tbody.appendChild(detailTr);
            }
        });
    }

    // --- LÓGICA DE DETALHES ---

    function buildDetailsHTML(assetId) {
        // Filtrar métricas deste ativo
        const metrics = globalData.details.filter(d => d.ATIVO_ID === assetId);

        let html = `<div class="system-grid">`;

        metrics.forEach(m => {
            // Define cor baseada no status
            let valColor = "";
            if(m.STATUS === 'positive') valColor = "color-green";
            if(m.STATUS === 'warning' || m.STATUS === 'negative') valColor = "color-red";
            if(m.STATUS === 'gold') valColor = "color-gold";

            // Se for o Insight/Obs, usa card largo
            if(m.METRICA.includes("Insight") || m.OBS.length > 50) {
                html += `
                    <div class="stat-card full-width-card">
                        <span class="stat-label" style="color:var(--gold)">${m.METRICA}</span>
                        <div class="stat-value" style="font-size: 0.9rem; line-height:1.5;">
                            ${m.OBS || m.VALOR}
                        </div>
                    </div>
                `;
            } else {
                // Card padrão
                html += `
                    <div class="stat-card">
                        <span class="stat-label">${m.METRICA}</span>
                        <div class="stat-value ${valColor}">
                            ${m.VALOR}<span class="stat-unit">${m.UNIDADE}</span>
                        </div>
                        ${m.OBS ? `<div style="font-size:0.65rem; color:var(--text-secondary); margin-top:8px; border-top:1px solid rgba(255,255,255,0.05); padding-top:4px;">${m.OBS}</div>` : ''}
                    </div>
                `;
            }
        });

        html += `</div>`;
        return html;
    }

    function toggleDetails(id, hasDetails) {
        if (!hasDetails) return;

        const detailRow = document.getElementById(`detail-${id}`);
        const masterRow = document.querySelector(`tr[data-id="${id}"]`);

        // Se já está aberto, fecha
        if (expandedRowId === id) {
            detailRow.classList.remove('visible');
            masterRow.classList.remove('expanded');
            expandedRowId = null;
            return;
        }

        // Se há outro aberto, fecha o anterior
        if (expandedRowId) {
            const oldDetail = document.getElementById(`detail-${expandedRowId}`);
            const oldMaster = document.querySelector(`tr[data-id="${expandedRowId}"]`);
            if(oldDetail) oldDetail.classList.remove('visible');
            if(oldMaster) oldMaster.classList.remove('expanded');
        }

        // Abre o novo
        detailRow.classList.add('visible');
        masterRow.classList.add('expanded');
        expandedRowId = id;
    }

    // Iniciar
    initDashboard();

</script>
</body>
</html>
